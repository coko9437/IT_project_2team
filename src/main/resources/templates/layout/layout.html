<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity6" class="h-100">
<head>
    <meta charset="UTF-8">
    <title>맛슐랭 원정대</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet" />

    <style>
        /* Bootstrap과 Tailwind CSS 충돌 시, 메뉴가 숨겨지는 문제를 해결하기 위한 강제 스타일 */
        @media (min-width: 992px) { /* navbar-expand-lg breakpoint */
            .navbar-collapse {
                display: flex !important;
                visibility: visible !important;
            }
        }
        /* 로그인/로그아웃 버튼 스타일 */
        .auth-button {
            margin-left: 10px; /* 기존 nav-item과의 간격 */
            padding: .375rem .75rem; /* 버튼 패딩 (Bootstrap 기본 버튼과 유사하게) */
            font-size: 1rem;
            line-height: 1.5;
            border-radius: .25rem;
            text-decoration: none;
            color: #fff; /* 기본 텍스트 색상 */
            background-color: #0d6efd; /* 파란색 배경 (primary) */
            border: 1px solid #0d6efd; /* 테두리 색상 */
            transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out;
        }

        .auth-button:hover {
            background-color: #0b5ed7; /* 호버 시 색상 */
            border-color: #0a58ca;
            color: #fff;
        }

        /* 폼 버튼 리셋 (기본 폼 버튼 스타일 제거) */
        .auth-button-form button {
            all: unset; /* 버튼의 모든 기본 스타일 제거 */
            cursor: pointer; /* 마우스 오버 시 포인터 표시 */
            /* 위에서 정의한 .auth-button 스타일을 상속받도록 처리 */
            margin-left: 10px;
            padding: .375rem .75rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: .25rem;
            text-decoration: none;
            color: #fff;
            background-color: #0d6efd;
            border: 1px solid #0d6efd;
            transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out;
        }

        .auth-button-form button:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
            color: #fff;
        }

        .user-info-display {
            display: flex; /* 가로 정렬 */
            flex-direction: column; /* 세로로 나열 */
            align-items: flex-end; /* 오른쪽 정렬 */
            margin-right: 15px; /* 로그인/로그아웃 버튼과의 간격 */
            font-size: 0.85rem; /* 기본 폰트 크기 */
            color: #555; /* 글자색 */
            line-height: 1.2; /* 줄 간격 */
        }

        .user-info-display .user-nickname {
            font-weight: bold; /* 닉네임은 조금 더 진하게 */
            color: #333; /* 닉네임 색상 */
            font-size: 0.9rem; /* 닉네임 크기 */
        }

        .user-info-display .user-role {
            font-size: 0.75rem; /* 역할은 더 작게 */
            color: #888; /* 역할 색상 */
            text-transform: uppercase; /* 역할을 대문자로 표시 */
        }

        /* 수정: 비로그인 상태일 때 텍스트 스타일 */
        .user-info-display .text-muted-smaller {
            font-size: 0.7rem; /* 로그인 시보다 더 작게 */
            color: #aaa; /* 더 흐린 색상 */
        }

        /* 모바일 뷰에서 닉네임/역할과 버튼이 너무 붙지 않도록 조정 (선택 사항) */
        @media (max-width: 991.98px) {
            .user-info-display {
                margin-right: 0;
                margin-bottom: 10px; /* 메뉴 항목 아래에 약간의 간격 */
                align-items: flex-start; /* 모바일에서는 왼쪽 정렬 */
            }
        }
    </style>
    <th:block layout:fragment="css"></th:block>
</head>
<body class="d-flex flex-column h-100">

<header class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" th:href="@{/main}" style="height: 50px; display: flex; align-items: center; overflow: hidden;">
            <img th:src="@{/layoutIMAGE/5.png}" alt="로고" style="height: 100%; object-fit: contain;">
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 문구 수정은 CommonControllerAdvice.java 에서 수정하면됨 -->
        <div class="d-flex align-items-center">
            <div class="user-info-display me-3">
                <span class="user-nickname" th:text="${loggedInUserNickname}" th:classappend="${loggedInUserNickname == '비로그인'} ? 'text-muted-smaller' : ''">닉네임</span>
                <span class="user-role" th:text="${loggedInUserRole}" th:classappend="${loggedInUserNickname == '비로그인'} ? 'text-muted-smaller' : ''">역할</span>
            </div>
<!---->
        <div class="collapse navbar-collapse" id="navbarNav">


                <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/main}">오점머</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/board/list}">맛슐랭원정대</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/review/list}">식후감</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/lunchmatch/list}">맛집저장</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/lunchmatch/map}">맛지도</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/myPage}">MY PAGE</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/inquiry/list}">1:1문의</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/notice/list}">공지사항</a></li>
            </ul>

                <div sec:authorize="!isAuthenticated()">
                    <a th:href="@{/login}" class="auth-button">로그인</a>
                </div>

                <div sec:authorize="isAuthenticated()" class="auth-button-form">
                    <form th:action="@{/logout}" method="post">
                        <div th:if="${_csrf}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        </div>
                        <button type="submit" class="auth-button">로그아웃</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="flex-grow-1">
    <div class="container">
        <div layout:fragment="content">
        </div>
    </div>
</main>

<footer class="mt-auto bg-light">
    <hr/>
    <div class="container text-center py-3">
        <p>&copy; 2025 오늘 점심 뭐 먹지? All rights reserved.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<th:block layout:fragment="script"></th:block>
</body>
</html>