<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="webproject_2team.lunch_matching.mapper.PartyBoardMapper">

    <insert id="insert" parameterType="PartyBoardVO">
        INSERT INTO party_board (writer_id, title, content, location_name, latitude, longitude, food_category, gender_limit, party_time, deadline)
        VALUES (#{writerId}, #{title}, #{content}, #{locationName}, #{latitude}, #{longitude}, #{foodCategory}, #{genderLimit}, #{partyTime}, #{deadline})
    </insert>

    <select id="selectAll" resultType="com.lunchmatch.domain.PartyBoardVO">
        SELECT * FROM party_board ORDER BY created_at DESC
    </select>

    <select id="selectOne" resultType="com.lunchmatch.domain.PartyBoardVO">
        SELECT * FROM party_board WHERE id = #{id}
    </select>

    <delete id="delete">
        DELETE FROM party_board WHERE id = #{id}
    </delete>

    <update id="update">
        UPDATE party_board
        SET
            title = #{title},
            content = #{content},
            location_name = #{locationName},
            latitude = #{latitude},
            longitude = #{longitude},
            food_category = #{foodCategory},
            gender_limit = #{genderLimit},
            status = #{status},
            party_time = #{partyTime},
            deadline = #{deadline}
        WHERE id = #{id}
    </update>

    <!-- 검색 및 필터 포함 페이징 -->
    <select id="selectList" resultType="com.lunchmatch.domain.PartyBoardVO">
        SELECT * FROM party_board
        <where>
            <if test="keyword != null and keyword != ''">
                title LIKE CONCAT('%', #{keyword}, '%')
            </if>
            <if test="foodCategory != null and foodCategory != ''">
                AND food_category = #{foodCategory}
            </if>
            <if test="genderLimit != null and genderLimit != ''">
                AND gender_limit = #{genderLimit}
            </if>
        </where>
        ORDER BY created_at DESC
        LIMIT #{size} OFFSET #{skip}
    </select>

    <select id="getCountWithFilter" resultType="int">
        SELECT COUNT(*) FROM party_board
        <where>
            <if test="keyword != null and keyword != ''">
                title LIKE CONCAT('%', #{keyword}, '%')
            </if>
            <if test="foodCategory != null and foodCategory != ''">
                AND food_category = #{foodCategory}
            </if>
            <if test="genderLimit != null and genderLimit != ''">
                AND gender_limit = #{genderLimit}
            </if>
        </where>
    </select>




</mapper>
